# yaml-language-server: $schema=https://raw.githubusercontent.com/evilmartians/lefthook/refs/heads/master/schema.json
pre-commit:
  jobs:
    - name: format
      group:
        jobs:
          - name: prettier
            # [Prettier is an opinionated code formatter.](https://github.com/prettier/prettier)
            run: prettier --ignore-unknown --write '{staged_files}'
            stage_fixed: true
            file_types:
              - text
            only:
              - run: prettier --version
post-checkout: &out_hook
  jobs:
    - name: npm-install
      # NOTE: 使用 `"` 可能由于双 `"` 导致语法问题
      # [lefthook] run: "C:\Program Files\Git\bin\sh.exe" -c "if [ -z "$CI" ]; then
      # TODO: 使用 only.run 检查 package.json 是否存在
      run: npm ci
      glob:
        - package.json
      only:
        - run: node --version
        - run: npm --version
post-merge: *out_hook
post-rewrite: *out_hook
